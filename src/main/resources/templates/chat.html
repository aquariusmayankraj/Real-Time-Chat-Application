<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Chat Application</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          crossorigin="anonymous">

    <!-- SockJS + StompJS -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@5.0.0/bundles/stomp.umd.js"></script>

    <style>
        body {
            background: #0f0f0f;
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #chat {
            height: 450px;
            overflow-y: auto;
            background: #1c1c1c;
            padding: 20px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        }

        .message {
            padding: 12px 20px;
            margin-bottom: 12px;
            border-radius: 20px;
            max-width: 70%;
            word-wrap: break-word;
            font-size: 0.95rem;
            transition: transform 0.15s ease, box-shadow 0.25s ease;
        }

        .message.self {
            background: linear-gradient(145deg, #28a745, #218838);
            align-self: flex-end;
            text-align: right;
            box-shadow: 4px 4px 15px rgba(0, 0, 0, 0.4);
            color: #fff;
        }

        .message.self:hover {
            transform: translateY(-3px);
            box-shadow: 6px 6px 25px rgba(0, 0, 0, 0.6);
        }

        .message.other {
            background: linear-gradient(145deg, #343a40, #495057);
            align-self: flex-start;
            box-shadow: 4px 4px 15px rgba(0, 0, 0, 0.4);
            color: #fff;
        }

        .message.other:hover {
            transform: translateY(-3px);
            box-shadow: 6px 6px 25px rgba(0, 0, 0, 0.6);
        }

        .input-group input {
    border-radius: 50px;
    background: #2c2c2c;   /* dark background */
    border: 1px solid #444;
    color: #fff;            /* text color */
}

.input-group input::placeholder {
    color: #bbb;
}

.input-group input:focus {
    background: #2c2c2c !important; /* keep dark background when typing */
    color: #fff;                     /* keep text white */
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25); /* optional blue glow */
}
        .input-group button {
            border-radius: 50px;
            padding: 0 30px;
            font-weight: bold;
            background: linear-gradient(145deg, #0d6efd, #0056b3);
            border: none;
            color: #fff;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            transition: transform 0.15s ease, box-shadow 0.25s ease;
        }

        .input-group button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        h1 {
            text-shadow: 2px 2px 10px rgba(0,0,0,0.7);
            color: #fff;
        }

        .container {
            max-width: 600px;
        }
    </style>
</head>
<body>
<div class="container mt-4">
    <h1 class="text-center mb-4">Real-Time Chat Application</h1>

    <!-- Chat Window -->
    <div id="chat" class="border rounded p-3 mb-3"></div>

    <!-- Sender Input -->
    <div class="input-group mb-3">
        <input id="senderInput" type="text" class="form-control" placeholder="Your Name...">
    </div>

    <!-- Message Input -->
    <div class="input-group mb-3">
        <input id="messageInput" type="text" class="form-control" placeholder="Type a Message...">
        <button id="sendMessage" class="btn btn-primary">Send</button>
    </div>
</div>

<script>
    let stompClient = null;

    function setConnected(connected) {
        document.getElementById('sendMessage').disabled = !connected;
    }

    function connect() {
        const socket = new SockJS('/ws-chat');
        stompClient = StompJs.Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            console.log('Connected:', frame);
            setConnected(true);

            stompClient.subscribe('/topic/messages', function (message) {
                showMessage(JSON.parse(message.body));
            });
        }, function (error) {
            console.error('STOMP connection error:', error);
        });
    }

    function showMessage(message) {
        const chat = document.getElementById('chat');
        const messageElement = document.createElement('div');
        messageElement.classList.add('message');

        const currentUser = document.getElementById('senderInput').value.trim();
        if (currentUser && message.sender === currentUser) {
            messageElement.classList.add('self');
        } else {
            messageElement.classList.add('other');
        }

        const time = new Date().toLocaleTimeString();
        messageElement.innerHTML = `<strong>${message.sender}</strong> [${time}]: ${message.content}`;
        chat.appendChild(messageElement);

        chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
    }

    function sendMessage() {
        let sender = document.getElementById('senderInput').value.trim();
        const content = document.getElementById('messageInput').value.trim();

        if (!stompClient || !stompClient.connected) {
            console.warn('WebSocket not connected yet');
            return;
        }
        if (!content) return;

        if (!sender) {
            sender = 'User' + Math.floor(Math.random() * 1000);
            document.getElementById('senderInput').value = sender;
        }

        const chatMessage = { sender: sender, content: content };
        stompClient.send("/app/sendMessage", {}, JSON.stringify(chatMessage));
        document.getElementById('messageInput').value = '';
    }

    document.getElementById('sendMessage').onclick = sendMessage;
    document.getElementById('messageInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') sendMessage();
    });

    window.onload = connect;
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
</body>
</html>
